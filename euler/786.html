<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>projecteuler solutions - Kirill Dikalin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Courier+Prime&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../euler/euler_css.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/styles/monokai-sublime.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
  <link rel="icon" href="../images/favicon.ico" type="image/x-icon">
</head>

<body>
  <ul class="breadcrumb">
      <a class="bread_crumb" href="../index.html">Kirill Dikalin</a> 
      / 
      <a class="bread_crumb" href="./euler.html">Решение задач Эйлера</a>
      / 
      786
  </ul>

  <div class="our_framework">
    <div class="section_content">
      <div id="toc_container">
            
        <h2 id="786">Бильярд</h2>

            <div align="justify" class="problem_content">
              <p> Диаграмма ниже показывает бильярдный стол особой четырехугольной формы. Четыре угла
                <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="0" style="font-size: 117.3%; position: relative;">
                  <mjx-assistive-mml unselectable="on" display="inline">
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <mi>A</mi>
                      <mo>,</mo>
                      <mi>B</mi>
                      <mo>,</mo>
                      <mi>C</mi>
                      <mo>,</mo>
                      <mi>D</mi>
                    </math>
                  </mjx-assistive-mml>
                </mjx-container> равны
                <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="1" style="font-size: 117.3%; position: relative;">
                  <mjx-assistive-mml unselectable="on" display="inline">
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <msup>
                        <mn>120</mn>
                        <mo>∘</mo>
                      </msup>
                      <mo>,</mo>
                      <msup>
                        <mn>90</mn>
                        <mo>∘</mo>
                      </msup>
                      <mo>,</mo>
                      <msup>
                        <mn>60</mn>
                        <mo>∘</mo>
                      </msup>
                      <mo>,</mo>
                      <msup>
                        <mn>90</mn>
                        <mo>∘</mo>
                      </msup>
                    </math>
                  </mjx-assistive-mml>
                </mjx-container> соответственно, а длины
                <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="2" style="font-size: 117.3%; position: relative;">
                  <mjx-assistive-mml unselectable="on" display="inline">
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <mi>A</mi>
                      <mi>B</mi>
                    </math>
                  </mjx-assistive-mml>
                </mjx-container> и
                <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="3" style="font-size: 117.3%; position: relative;">
                  <mjx-assistive-mml unselectable="on" display="inline">
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <mi>A</mi>
                      <mi>D</mi>
                    </math>
                  </mjx-assistive-mml>
                </mjx-container> равны между собой.</p>
              <div style="text-align:center; display: flex; justify-content: center;"> 
                <img src="https://projecteuler.net/project/images/p786_billiard_shape.jpg" 
                class="dark_img_big" alt="" height="160"> 
              </div>
              <p> Диаграмма слева показывает траекторию бесконечного малого бильярдного шара, начавшего движение из точки
                <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="4" style="font-size: 117.3%; position: relative;">
                  <mjx-assistive-mml unselectable="on" display="inline">
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <mi>A</mi>
                    </math>
                  </mjx-assistive-mml>
                </mjx-container>, дважды отбившегося от бортов стола и вернувшегося обратно в точку
                <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="5" style="font-size: 117.3%; position: relative;">
                  <mjx-assistive-mml unselectable="on" display="inline">
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <mi>A</mi>
                    </math>
                  </mjx-assistive-mml>
                </mjx-container>. Диаграмма справа показывает другую такую траекторию, но на этот раз шар отбился от бортов восемь раз:</p>
                <div style="text-align:center; display: flex; justify-content: center; width: 1000px; height: 400px;"> 
                  <img src="https://projecteuler.net/project/images/p786_billiard_traces.jpg" 
                  class="dark_img_big_high_width" alt="" height="160"> 
                </div>
              <p> На столе отсутствует трение и все отскоки являются идеально эластичными столкновениями.
                <br> Заметим, что ни один отскок не должен происходить в любом из углов стола, так как поведение шара в таком случае будет непредсказуемым. </p>
              <p> Пусть
                <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="6" style="font-size: 117.3%; position: relative;">
                  <mjx-assistive-mml unselectable="on" display="inline">
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <mi>B</mi>
                      <mo stretchy="false">(</mo>
                      <mi>N</mi>
                      <mo stretchy="false">)</mo>
                    </math>
                  </mjx-assistive-mml>
                </mjx-container> будет количеством возможных траекторий шара, начавшего движение из точки
                <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="7" style="font-size: 117.3%; position: relative;">
                  <mjx-assistive-mml unselectable="on" display="inline">
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <mi>A</mi>
                    </math>
                  </mjx-assistive-mml>
                </mjx-container>, отбившегося не более
                <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="8" style="font-size: 117.3%; position: relative;">
                  <mjx-assistive-mml unselectable="on" display="inline">
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <mi>N</mi>
                    </math>
                  </mjx-assistive-mml>
                </mjx-container> раз от бортов и вернувшегося обратно в точку
                <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="9" style="font-size: 117.3%; position: relative;">
                  <mjx-assistive-mml unselectable="on" display="inline">
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <mi>A</mi>
                    </math>
                  </mjx-assistive-mml>
                </mjx-container>. </p>
              <p> Например,
                <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="10" style="font-size: 117.3%; position: relative;">
                  <mjx-assistive-mml unselectable="on" display="inline">
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <mi>B</mi>
                      <mo stretchy="false">(</mo>
                      <mn>10</mn>
                      <mo stretchy="false">)</mo>
                      <mo>=</mo>
                      <mn>6</mn>
                    </math>
                  </mjx-assistive-mml>
                </mjx-container>,
                <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="11" style="font-size: 117.3%; position: relative;">
                  <mjx-assistive-mml unselectable="on" display="inline">
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <mi>B</mi>
                      <mo stretchy="false">(</mo>
                      <mn>100</mn>
                      <mo stretchy="false">)</mo>
                      <mo>=</mo>
                      <mn>478</mn>
                    </math>
                  </mjx-assistive-mml>
                </mjx-container>,
                <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="12" style="font-size: 117.3%; position: relative;">
                  <mjx-assistive-mml unselectable="on" display="inline">
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <mi>B</mi>
                      <mo stretchy="false">(</mo>
                      <mn>1000</mn>
                      <mo stretchy="false">)</mo>
                      <mo>=</mo>
                      <mn>45790</mn>
                    </math>
                  </mjx-assistive-mml>
                </mjx-container>. </p>
              <p> Найдите
                <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="13" style="font-size: 117.3%; position: relative;">
                  <mjx-assistive-mml unselectable="on" display="inline">
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <mi>B</mi>
                      <mo stretchy="false">(</mo>
                      <msup>
                        <mn>10</mn>
                        <mn>9</mn>
                      </msup>
                      <mo stretchy="false">)</mo>
                    </math>
                  </mjx-assistive-mml>
                </mjx-container>. </p>
            </div>

        <h2>Решение</h2>

        <p align="justify" class="p_on_project_pages">
          Итак, чтобы понять решение нам необходимо ознакомиться с некоторыми понятиями.
        </p>

        <p align="justify" class="p_on_project_pages">
          <strong>Функция Мёбиуса</strong> - это функция, которая используется в теории 
          чисел для изучения свойств деления чисел и факторизации. Она задается для каждого 
          положительного целого числа и зависит от количества различных простых множителей 
          в разложении этого числа на множители. Если число содержит повторяющиеся простые 
          множители, то функция Мёбиуса равна 0. Если число содержит нечетное число различных 
          простых множителей, то функция Мёбиуса равна -1. Если число содержит четное число 
          различных простых множителей, то функция Мёбиуса равна 1.
        </p>

        <p align="justify" class="p_on_project_pages">
          В простых словах, функция Мёбиуса позволяет описывать, как происходит разложение 
          числа на простые множители. Она является важным инструментом в теории чисел и находит 
          применение в различных задачах, связанных с делением чисел и факторизацией.
        </p>

        <p align="justify" class="p_on_project_pages">
          <strong>Мертенсова функция</strong> — это функция, которая определяется для каждого натурального 
          числа n как сумма знаков функции Мёбиуса от 1 до n. Знак функции Мёбиуса зависит 
          от того, сколько простых множителей имеет число. Если число имеет четное количество 
          простых множителей, то знак равен 1. Если число имеет нечетное количество простых 
          множителей, то знак равен -1. Если число делится на квадрат простого числа, то 
          знак равен 0.
        </p>

        <p align="justify" class="p_on_project_pages">
          В простых словах, Мертенсова функция позволяет считать количество простых чисел 
          на интервале от 1 до n, а также содержит информацию о распределении простых и 
          составных чисел на этом интервале. Она является важным инструментом в теории 
          чисел и находит применение в различных задачах, связанных с простыми числами.
        </p>

        <p align="justify" class="p_on_project_pages">
          Код решения:
        </p>

        <pre><code class="language-python">
          from functools import lru_cache
          from math import sqrt,floor
          
          N=1000000000
          z=0
          
          def sqrttrick(n):
              f=floor(sqrt(n))
              for i in range(1,n//(f+1)+1):
                  yield (i,i,n//i)
              for i in range(f,0,-1):
                  yield (n//(i+1)+1,n//i,i)
                  
          def calcN(a, b, c): 
              if a<b: a,b=b,a
              if a>c: return 0
              m = c//a
              if a == b:
                  return m*(m - 1)//2;
              else:
                  k = (a - 1)//b
                  h = (c - a*m)//b
                  return calcN(b, a - b*k, c - b*(k*m + h)) + k*m*(m - 1)//2 + m*h        
              
          @lru_cache(maxsize=None)
          def mertens(n):
              if n<=1: return n
              z=1
              for a,b,c in sqrttrick(n):
                  if c< n: z-=mertens(c)*(b-a+1)
              return z
          
          def mertens3(n):
              z=0
              while(n):
                  z+=mertens(n)
                  n//=3
              return z
          
          for a,b,g in sqrttrick(3*N+6):
              q = calcN(18,10,g) - calcN(18,30,g)
              if q==0: break
              z+=(mertens3(b) - mertens3(a-1))*q
              
          print (z*4+2)
        </code></pre></br>

      <h2>Разберём теперь что тут происходит</h2>

      <p align="justify" class="p_on_project_pages">
        Этот код вычисляет Мертенсову функцию M(n), которая определяется как сумма значений 
        функции μ(k) (функция Мёбиуса) на отрезке [1,n], где μ(1) = 1, а для k > 1 равна 0, если
         k имеет квадратный делитель, и (-1)^r, если k является произведением r различных простых 
         чисел.
      </p>

      <p align="justify" class="p_on_project_pages">
        1. Импортируем необходимые модули:
        <ul>
          <li>functools.lru_cache используется для создания декоратора мемоизации функций.</br>
          <li>math.sqrt используется для вычисления квадратного корня.</br>
          <li>math.floor используется для округления вниз.</br>
        </ul>
      </p>

      <p align="justify" class="p_on_project_pages">
        2. Задаем константу N = 1000000000 и переменную z = 0.
      </p>

      <p align="justify" class="p_on_project_pages">
        3. Определяем функцию sqrttrick(n), которая используется для генерации троек (a, b, c), 
        где a × b = n и a ≤ b ≤ c. Эта функция использует "метод квадратного корня", чтобы генерировать 
        эти тройки. Первый цикл for используется для генерации всех троек, где b ≤ sqrt(n), а второй цикл 
        for используется для генерации оставшихся троек. Функция возвращает каждую тройку в виде кортежа 
        (i, j, k) с помощью генератора yield.
      </p>

      <p align="justify" class="p_on_project_pages">
        4. Определяем функцию calcN(a, b, c), которая используется для вычисления количества чисел на 
        отрезке [a, c], которые делятся на b. Эта функция используется для вычисления суммы значений 
        функции μ(k) на отрезке [a, c]. Функция использует рекурсию для расчета значения суммы, 
        пока a ≤ c. Функция возвращает сумму значений μ(k) на отрезке [a, c].
      </p>

      <p align="justify" class="p_on_project_pages">
        5. Определяем функцию mertens(n), которая вычисляет значение Мертенсовой функции для n. Для этого 
        функция использует цикл for для перебора всех троек (a, b, c), которые генерируются функцией 
        sqrttrick(n). Если c < n, то значение Мертенсовой функции для c умножается на (b - a + 1) и 
        вычитается из z. Функция возвращает z.
      </p>

      <p align="justify" class="p_on_project_pages">
        6. Определяем функцию mertens3(n), которая используется для вычисления значения Мертенсовой функции 
        для каждого третьего числа в интервале [1, n]. Функция использует цикл while для перебора каждого 
        третьего числа и вызывает функцию mertens для каждого третьего числа. Значения Мертенсовой функции 
        для каждого третьего числа складываются в z, который затем возвращается.
      </p>

      <p align="justify" class="p_on_project_pages">
        7. Декоратор lru_cache используется для кэширования результатов вызовов функции mertens. Это 
        позволяет избежать повторных вычислений для одного и того же значения аргумента функции.
      </p>
      
      <p align="justify" class="p_on_project_pages">
        8. В основной части программы используется цикл for для перебора всех троек (a, b, g), которые 
        генерируются функцией sqrttrick(3*N+6). Затем вызывается функция calcN(18, 10, g) - calcN(18, 30, g) 
        для вычисления количества чисел на отрезке [10, g], которые делятся на 18, но не делятся на 30. Это 
        значение сохраняется в переменную q.
      </p>

      <p align="justify" class="p_on_project_pages">
        9. Затем выполняется вычисление мертенсовой функции для каждого числа в интервале [a, b] с помощью 
        функции mertens3(b) - mertens3(a-1). Разница значений мертенсовой функции между b и a-1 умножается 
        на q и добавляется к переменной z.
      </p>

      <p align="justify" class="p_on_project_pages">
        10. Наконец, значение z умножается на 4 и прибавляется 2, и результат выводится на экран с помощью функции print.
      </p>


