<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>Число Пи — тренировка памяти — Kirill Dikalin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Тренажёр на запоминание первых цифр числа Пи.">
  <meta property="og:title" content="Число Пи — тренировка памяти"/>
  <meta property="og:description" content="Введите по порядку первые цифры числа Пи и тренируйте память."/>
  <meta property="og:type" content="website"/>
  <meta property="og:url" content="/brain/pi.html"/>
  <link rel="canonical" href="/brain/pi.html">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Courier+Prime&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/style.css">
  <link rel="icon" href="../images/favicon.ico" type="image/x-icon">
  <style>
    #input-field { width: 50px; }
    .controls { margin: 20px 0; }
    .progress-container { margin: 20px 0; }
    .progress-bar { 
      width: 100%; 
      height: 20px; 
      background-color: #f0f0f0; 
      border-radius: 10px; 
      overflow: hidden; 
    }
    .progress-fill { 
      height: 100%; 
      background-color: #4CAF50; 
      transition: width 0.3s ease; 
      width: 0%; 
    }
    .progress-text { 
      text-align: center; 
      margin-top: 10px; 
      font-weight: bold; 
    }
    .difficulty-selector { margin: 20px 0; }
    .difficulty-selector label { margin-right: 15px; }
    .hidden-digits { color: #ccc; }
    .toggle-digits-btn { margin: 10px 0; }
    .restart-btn { 
      background-color: #f44336; 
      color: white; 
      border: none; 
      padding: 10px 20px; 
      border-radius: 5px; 
      cursor: pointer; 
      margin: 10px 0; 
    }
    .restart-btn:hover { background-color: #d32f2f; }
    
    /* Стили для отображения длинных чисел */
    #digits-display {
      word-wrap: break-word;
      word-break: break-all;
      overflow-wrap: break-word;
      white-space: pre-wrap;
      max-width: 100%;
      font-family: 'Courier Prime', monospace;
      line-height: 1.4;
    }
    
    /* Обеспечиваем перенос длинных строк */
    .section_content {
      max-width: 100%;
      overflow-x: auto;
    }
    
    /* Адаптивность для мобильных устройств */
    @media screen and (max-width: 768px) {
      #digits-display {
        font-size: 14px;
        line-height: 1.2;
      }
      
      .difficulty-selector label {
        display: block;
        margin-bottom: 5px;
      }
    }
  </style>
</head>
<body>
  <ul class="breadcrumb">
    <a class="bread_crumb" href="../index.html">Kirill Dikalin</a> / <a class="bread_crumb" href="../brain/main_brain.html">brain</a> / pi
  </ul>

  <h1>Число Пи</h1>

  <div class="our_framework">
    <div class="section_content">
      <div class="difficulty-selector">
        <label>Сложность: </label>
        <input type="radio" name="difficulty" value="50" id="diff50"> <label for="diff50">50 цифр</label>
        <input type="radio" name="difficulty" value="100" id="diff100" checked> <label for="diff100">100 цифр</label>
        <input type="radio" name="difficulty" value="200" id="diff200"> <label for="diff200">200 цифр</label>
        <input type="radio" name="difficulty" value="500" id="diff500"> <label for="diff500">500 цифр</label>
        <input type="radio" name="difficulty" value="1000" id="diff1000"> <label for="diff1000">1000 цифр</label>
      </div>

      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="progress-text" id="progress-text">0/100 цифр введено</div>
      </div>

      <button class="toggle-digits-btn" id="toggle-digits">Скрыть цифры</button>
      <button class="restart-btn" id="restart-btn">Начать заново</button>

      <p class="p_on_project_pages" id="digits-display">
        1415926535 8979323846 2643383279 5028841971 6939937510 
        5820974944 5923078164 0628620899 8628034825 3421170679 
        8214808651 3282306647 0938446095 5058223172 5359408128
        4811174502 8410270193 8521105559 6446229489 5493038196
      </p>

      <div>
        <label for="input-field">Продолжай... 3,</label>
        <input type="text" id="input-field">
      </div>
    </div>
  </div>

  <script>
    // Расширенная строка Пи (1000 цифр)
    const FULL_PI = "1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632788659361533818279682303019520353018529689957736225994138912497217752834791315155748572424541506959508295331168617278558890750983817546374649393192550604009277016711390098488240128583616035637076601047101819429555961989467678374494482553797747268471040475346462080466842590694912933136770289891521047521620569660240580381501935112533824300355876402474964732639141992726042699227967823547816360093417216412199245863150302861829745557067498385054945885869269956909272107975093029553211653449872027559602364806654991198818347977535663698074265425278625518184175746728909777727938000816470600161452491921732172147723501414419735685481613611573525521334757418494684385233239073941433345477624168625189835694855620992192221842725502542568876717904946016746";
    
    let PI = FULL_PI.substring(0, 100); // По умолчанию 100 цифр
    let currentIndex = 0;
    let digitsHidden = false;
    let gameCompleted = false;
    let lastError = false; // Флаг для отслеживания последней ошибки
    
    const inputField = document.querySelector('#input-field');
    const digits = document.querySelector('#digits-display');
    const progressFill = document.querySelector('#progress-fill');
    const progressText = document.querySelector('#progress-text');
    const toggleBtn = document.querySelector('#toggle-digits');
    const restartBtn = document.querySelector('#restart-btn');
    const difficultyInputs = document.querySelectorAll('input[name="difficulty"]');

    function updateProgress() {
      const percentage = (currentIndex / PI.length) * 100;
      progressFill.style.width = percentage + '%';
      progressText.textContent = `${currentIndex}/${PI.length} цифр введено`;
      
      // Обновляем заголовок страницы для отображения прогресса
      if (currentIndex > 0 && currentIndex < PI.length) {
        document.title = `Пи: ${currentIndex}/${PI.length} — тренировка памяти — Kirill Dikalin`;
      } else if (currentIndex === PI.length) {
        document.title = `Пи: Завершено! — тренировка памяти — Kirill Dikalin`;
      } else {
        document.title = `Число Пи — тренировка памяти — Kirill Dikalin`;
      }
    }

    function formatDigits(digitsString) {
      // Разбиваем на группы по 10 цифр с переносами строк для лучшей читаемости
      const groups = [];
      for (let i = 0; i < digitsString.length; i += 10) {
        const group = digitsString.slice(i, i + 10);
        groups.push(group);
      }
      return groups.join(' ');
    }

    function formatDigitsWithSpans(digitsString, inputString) {
      // Форматируем с пробелами, но сохраняем цветовую разметку
      const groups = [];
      for (let i = 0; i < digitsString.length; i += 10) {
        const group = digitsString.slice(i, i + 10);
        groups.push(group);
      }
      return groups.join(' ');
    }

    function displayDigits() {
      if (digitsHidden) {
        digits.innerHTML = '<span class="hidden-digits">[Цифры скрыты]</span>';
      } else {
        // Показываем цифры с цветовой разметкой введённых частей
        const inputString = inputField.value;
        if (inputString.length > 0) {
          if (lastError) {
            // Если была ошибка, показываем красную цифру
            const correctPart = `<span style="color: green">${inputString}</span>`;
            const wrongPart = `<span style="color: red">${PI[inputString.length]}</span>`;
            const restPart = PI.slice(inputString.length + 1);
            const outputString = `${correctPart}${wrongPart}${restPart}`;
            digits.innerHTML = outputString;
          } else {
            // Обычный случай - всё зелёное
            const correctPart = `<span style="color: green">${inputString}</span>`;
            const restPart = PI.slice(inputString.length);
            const outputString = `${correctPart}${restPart}`;
            digits.innerHTML = outputString;
          }
        } else {
          // Форматируем цифры с правильными переносами
          const formattedDigits = formatDigits(PI);
          digits.innerHTML = formattedDigits;
        }
      }
    }

    function restart() {
      currentIndex = 0;
      gameCompleted = false;
      lastError = false;
      inputField.value = '';
      inputField.disabled = false;
      inputField.style.width = '50px';
      displayDigits();
      updateProgress();
      inputField.focus();
    }

    function setDifficulty(length) {
      PI = FULL_PI.substring(0, length);
      restart();
    }

    // Обработчики событий
    difficultyInputs.forEach(input => {
      input.addEventListener('change', function() {
        setDifficulty(parseInt(this.value));
      });
    });

    toggleBtn.addEventListener('click', function() {
      digitsHidden = !digitsHidden;
      this.textContent = digitsHidden ? 'Показать цифры' : 'Скрыть цифры';
      displayDigits();
    });

    restartBtn.addEventListener('click', restart);

    inputField.addEventListener('input', function(event) {
      if (gameCompleted) return;
      
      const value = event.data;
      const correctDigit = PI[currentIndex];

      if (isNaN(parseInt(value, 10)) || value !== correctDigit) {
        const inputString = inputField.value.slice(0, -1);
        inputField.value = inputString;
        lastError = true;
        if (!digitsHidden) {
          const correctPart = `<span style="color: green">${inputString}</span>`;
          const wrongPart = `<span style="color: red">${correctDigit}</span>`;
          const restPart = PI.slice(inputString.length + 1);
          const outputString = `${correctPart}${wrongPart}${restPart}`;
          digits.innerHTML = outputString;
        }
        return;
      }

      const inputString = inputField.value;
      lastError = false; // Сбрасываем флаг ошибки при правильном вводе
      if (!digitsHidden) {
        const correctPart = `<span style="color: green">${inputString}</span>`;
        const restPart = PI.slice(inputString.length);
        const outputString = `${correctPart}${restPart}`;
        digits.innerHTML = outputString;
      }
      // Если цифры скрыты, ничего не показываем, но состояние сохраняется

      currentIndex++;
      updateProgress();

      if (currentIndex === PI.length) {
        alert(`Поздравляем! Вы ввели первые ${PI.length} знаков числа Пи после запятой.`);
        inputField.disabled = true;
        gameCompleted = true;
      }

      // Автоматическое расширение поля ввода
      const span = document.createElement('span');
      span.style.fontSize = window.getComputedStyle(inputField).fontSize;
      span.style.fontFamily = window.getComputedStyle(inputField).fontFamily;
      span.textContent = inputField.value;
      document.body.appendChild(span);
      const inputWidth = span.offsetWidth + 2;
      document.body.removeChild(span);
      inputField.style.width = inputWidth + 'px';
    });

    // Инициализация
    updateProgress();
    inputField.focus();
  </script>
</body>
</html>
